<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Physics with Rajiv</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f7fa; }
    h1 { color: #2c3e50; }
    .card { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .badge { padding: 4px 8px; background: #3498db; color: white; border-radius: 4px; margin-right: 5px; font-size: 12px; }
    .admin-only { display: none; margin-top: 20px; }
    .hidden { display: none; }
    button { margin: 5px; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; }
    .btn-login { background: #2ecc71; color: white; }
    .btn-logout { background: #e74c3c; color: white; }
    .btn-save { background: #2980b9; color: white; }
  </style>
</head>
<body>
  <h1>Physics Problems Website</h1>
  
  <!-- Auth buttons -->
  <div id="authSection">
    <button id="loginBtn" class="btn-login">Login with Google</button>
    <button id="logoutBtn" class="btn-logout hidden">Logout</button>
  </div>
  
  <!-- Add problem form (only visible for you as admin) -->
  <div id="adminPanel" class="admin-only">
    <h2>Add New Problem</h2>
    <input id="f_title" placeholder="Title"><br><br>
    <input id="f_topic" placeholder="Topic"><br><br>
    <select id="f_diff">
      <option value="Easy">Easy</option>
      <option value="Medium">Medium</option>
      <option value="Hard">Hard</option>
    </select><br><br>
    <input id="f_tags" placeholder="Tags (comma separated)"><br><br>
    <textarea id="f_stmt" placeholder="Problem Statement"></textarea><br><br>
    <textarea id="f_sol" placeholder="Solution"></textarea><br><br>
    <button id="save" class="btn-save">Save Problem</button>
  </div>
  
  <h2>All Problems</h2>
  <div id="list"></div>
  
  <!-- Firebase SDKs -->
  <script type="module">
    // Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";
    
    // Config
    const firebaseConfig = {
      apiKey: "AIzaSyCxDMgxlkSNT9gMAcMuu7W1we3MNwPDIoo",
      authDomain: "physicswithrajiv.firebaseapp.com",
      projectId: "physicswithrajiv",
      storageBucket: "physicswithrajiv.appspot.com",
      messagingSenderId: "1022315363672",
      appId: "1:1022315363672:web:51826dc6167cf4539ef92d"
    };

    // Init Firebase
    const appFB = initializeApp(firebaseConfig);
    const auth = getAuth(appFB);
    const provider = new GoogleAuthProvider();
    const db = getFirestore(appFB);

    // DOM Elements
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const adminPanel = document.getElementById("adminPanel");

    // Login
    loginBtn.onclick = async () => {
      try {
        await signInWithPopup(auth, provider);
      } catch (err) {
        alert("Login failed: " + err.message);
      }
    };

    // Logout
    logoutBtn.onclick = async () => {
      await signOut(auth);
    };

    // Auth State Listener
    onAuthStateChanged(auth, (user) => {
      if (user) {
        logoutBtn.classList.remove("hidden");
        loginBtn.classList.add("hidden");
        if (user.email === "rajivksinhaiit@gmail.com") {
          adminPanel.style.display = "block"; // show admin panel
        } else {
          adminPanel.style.display = "none"; // hide for others
        }
      } else {
        loginBtn.classList.remove("hidden");
        logoutBtn.classList.add("hidden");
        adminPanel.style.display = "none";
      }
    });

    // Save Problem
    document.getElementById("save").onclick = async () => {
      const problemData = {
        title: document.getElementById("f_title").value,
        topic: document.getElementById("f_topic").value,
        difficulty: document.getElementById("f_diff").value,
        tags: document.getElementById("f_tags").value.split(",").map(t => t.trim()),
        stmt: document.getElementById("f_stmt").value,
        sol: document.getElementById("f_sol").value,
        created: new Date().toISOString()
      };

      try {
        await addDoc(collection(db, "problems"), problemData);
        alert("Problem saved!");
        loadProblems();
      } catch (err) {
        console.error("Error adding problem:", err);
      }
    };

    // Load Problems
    async function loadProblems() {
      const listDiv = document.getElementById("list");
      listDiv.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "problems"));
      querySnapshot.forEach((docSnap) => {
        const p = docSnap.data();
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <h3>${p.title}</h3>
          <span class="badge">${p.topic}</span>
          <span class="badge">${p.difficulty}</span>
          <p>${p.stmt}</p>
          <details><summary>Solution</summary><p>${p.sol}</p></details>
        `;
        listDiv.appendChild(card);
      });
    }

    // Load on page start
    window.onload = loadProblems;
  </script>
</body>
</html>
